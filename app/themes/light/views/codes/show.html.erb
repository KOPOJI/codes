<% if @code.nil? %>
    <%= t 'no_codes' %>..
<% else %>

  <% #cache @code do %>

    <% title = @code.title.empty? ? "#{t 'Code'} ##{@code.id}" : @code.title %>
    <% title.sub! /unnamed(?=\s*?#\d+)/i, "#{t 'Code'}" %>
    <% content_for :title, "#{t 'Show code'} #{title}" %>

       <div class="post">

      <div style="font-size:10px;font-style:italic;border-bottom: 1px solid #CCC;padding:3px;margin:3px;padding-left:15px">
        <%= t 'Added by' %> <b><%= @code.user.nil? ? t('Guest') : @code.user.username %></b> <%= @code.created_at.to_s(:ru_datetime) %><br>
        <%= t 'Last edited' %>: <%= @code.updated_at.to_s(:ru_datetime) %>
      </div>

        <%= raw nl2br(parse_bb_codes @code.code) %>

      <% if @attachments.present? %>
          <fieldset>
            <legend> <%= t 'Attachments' %> </legend>
            <% @attachments.each do |image| %>
                <% cache image do %>
                  <%= link_to image_path(image.image) do %>
                      <%= image_tag image.image, class: 'attach' %>
                  <% end %>
                <% end %>
            <% end %>
          </fieldset>
      <% end %>

    </div>

  <% #end %>

    <% tags = title.gsub(/[^а-яА-ЯЁёA-Za-z]/u, ' ').split(/[_ !.,:;]+/u).delete_if{|x| x.to_s.length < 3} %>
    <% title "#{t 'Show code'} #{title}" %>
    <% description "#{t 'Show code'} #{title}, #{t 'added by'} #{@code.user.nil? ? t('Guest') : @code.user.username}" %>
    <% keywords    "#{t 'Show code'} #{title},#{t 'code'}, #{tags.join(',')}" %>

    <% set_meta_tags og: {type: 'article'} %>
    <% article = {
        published_time: @code.created_at,
        modified_time: @code.updated_at,
        expiration_time: Time.zone.now + 5.day,
        tag: tags,
    }
    article[:section] = '1C-Bitrix' if title =~ /bitrix/i

    %>
    <% unless @code.user.nil? %>
        <% set_meta_tags author: "#{request.base_url}/#{locale}/user/#{@code.user.id}#{url_suffix}" %>
        <% article[:author] = ["#{request.base_url}/#{locale}/user/#{@code.user.id}#{url_suffix}"] %>
    <% end %>

    <% set_meta_tags og: {article: article} %>

<% end %>

